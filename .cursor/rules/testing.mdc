# Healthcare Testing Methodologies & Quality Assurance

## Healthcare Testing Strategy Overview

- Use **Jest** as the primary testing framework for healthcare application reliability
- Use **React Testing Library** for healthcare component testing with accessibility focus
- Use **MSW (Mock Service Worker)** for healthcare API mocking with PHI protection
- Organize tests alongside healthcare source files or in `__tests__` directories
- Implement comprehensive testing for healthcare workflows and patient safety
- **CRITICAL**: Test all HIPAA compliance features and PHI handling

## Healthcare Component Testing Standards

- **Patient Safety Focus**: Test all healthcare components for data integrity and user safety
- **Accessibility Testing**: Ensure all healthcare interfaces work with assistive technologies
- **Component Scenarios**:
  ```typescript
  // Test healthcare component rendering and interactions
  describe('PatientAppointmentCard', () => {
    test('displays patient appointment information securely', () => {
      const mockAppointment = {
        id: 'APT-123',
        patientName: 'Test Patient',
        appointmentTime: new Date('2024-01-15T10:00:00Z'),
        providerName: 'Dr. Smith',
        status: 'confirmed'
      };
      
      render(<PatientAppointmentCard appointment={mockAppointment} />);
      
      // Test proper data display
      expect(screen.getByText('Test Patient')).toBeInTheDocument();
      expect(screen.getByText('Dr. Smith')).toBeInTheDocument();
      
      // Test accessibility
      expect(screen.getByRole('button', { name: /reschedule appointment/i })).toBeInTheDocument();
    });
    
    test('handles PHI masking for unauthorized users', () => {
      const unauthorizedUser = { role: 'guest' };
      render(<PatientAppointmentCard appointment={mockAppointment} user={unauthorizedUser} />);
      
      // Ensure PHI is properly masked
      expect(screen.queryByText('Test Patient')).not.toBeInTheDocument();
      expect(screen.getByText('[PROTECTED]')).toBeInTheDocument();
    });
  });
  ```

## Healthcare API Testing & Security

- **Test all healthcare endpoints** with proper request/response validation
- **Security Testing**: Test authentication, authorization, and data protection
- **PHI Protection Testing**: Ensure no sensitive data leaks in API responses
- **Healthcare API Test Examples**:
  ```typescript
  describe('Appointment API', () => {
    test('schedules appointment with proper validation', async () => {
      const appointmentData = {
        patientId: 'PAT-123',
        providerId: 'DOC-456',
        appointmentDate: '2024-01-15T10:00:00Z',
        appointmentType: 'routine_checkup'
      };
      
      msw.rest.post('/api/v1/appointments', (req, res, ctx) => {
        // Test proper authentication
        expect(req.headers.get('authorization')).toBeTruthy();
        
        return res(
          ctx.status(201),
          ctx.json({
            success: true,
            data: { appointmentId: 'APT-789', ...appointmentData }
          })
        );
      });
      
      const result = await scheduleAppointment(appointmentData);
      expect(result.success).toBe(true);
      expect(result.data.appointmentId).toBe('APT-789');
    });
    
    test('prevents unauthorized access to patient data', async () => {
      msw.rest.get('/api/v1/patients/:id', (req, res, ctx) => {
        // Simulate unauthorized access
        return res(ctx.status(403), ctx.json({ error: 'Unauthorized' }));
      });
      
      await expect(fetchPatientData('PAT-123')).rejects.toThrow('Unauthorized');
    });
  });
  ```

## Healthcare Unit Testing & Business Logic

- **Medical Logic Testing**: Test healthcare calculations, validations, and business rules
- **Data Validation Testing**: Test all healthcare data validation using Zod schemas
- **Healthcare Utility Testing**:
  ```typescript
  describe('Healthcare Utilities', () => {
    test('calculates appointment duration correctly', () => {
      const start = new Date('2024-01-15T10:00:00Z');
      const end = new Date('2024-01-15T10:30:00Z');
      
      expect(calculateAppointmentDuration(start, end)).toBe(30); // minutes
    });
    
    test('validates medical record number format', () => {
      expect(validateMedicalRecordNumber('MRN-123456')).toBe(true);
      expect(validateMedicalRecordNumber('invalid')).toBe(false);
    });
    
    test('masks PHI in error messages', () => {
      const errorWithPHI = 'Patient John Doe (SSN: 123-45-6789) appointment failed';
      const maskedError = maskPHIInErrorMessage(errorWithPHI);
      
      expect(maskedError).not.toContain('John Doe');
      expect(maskedError).not.toContain('123-45-6789');
      expect(maskedError).toContain('[REDACTED]');
    });
  });
  ```

## Healthcare Integration Testing

- **Healthcare Workflow Testing**: Test complete patient journey workflows
- **Form Integration Testing**: Test complex medical forms with validation
- **Authentication Flow Testing**: Test healthcare user authentication and authorization
- **Integration Test Examples**:
  ```typescript
  describe('Appointment Scheduling Workflow', () => {
    test('complete appointment scheduling flow', async () => {
      // 1. User authentication
      const user = await loginUser({ email: 'patient@test.com', password: 'test123' });
      expect(user.role).toBe('patient');
      
      // 2. Provider selection
      const providers = await fetchAvailableProviders();
      expect(providers.length).toBeGreaterThan(0);
      
      // 3. Time slot selection
      const timeSlots = await fetchAvailableTimeSlots(providers[0].id, '2024-01-15');
      expect(timeSlots).toContainEqual(expect.objectContaining({ time: '10:00' }));
      
      // 4. Appointment creation
      const appointment = await scheduleAppointment({
        patientId: user.id,
        providerId: providers[0].id,
        appointmentDate: '2024-01-15T10:00:00Z'
      });
      
      expect(appointment.success).toBe(true);
      expect(appointment.data.status).toBe('scheduled');
    });
  });
  ```

## Healthcare End-to-End Testing

- Use **Playwright** for healthcare workflow E2E testing
- Test critical healthcare user journeys across browsers
- Test healthcare accessibility compliance
- **E2E Test Examples**:
  ```typescript
  test('patient can schedule appointment end-to-end', async ({ page }) => {
    // Login as patient
    await page.goto('/auth/login');
    await page.fill('[data-testid="email"]', 'patient@test.com');
    await page.fill('[data-testid="password"]', 'password123');
    await page.click('[data-testid="login-button"]');
    
    // Navigate to appointment scheduling
    await page.click('[data-testid="schedule-appointment"]');
    
    // Select provider
    await page.selectOption('[data-testid="provider-select"]', 'dr-smith');
    
    // Select date and time
    await page.click('[data-testid="date-picker"]');
    await page.click('[data-testid="date-2024-01-15"]');
    await page.click('[data-testid="time-10-00"]');
    
    // Submit appointment
    await page.click('[data-testid="confirm-appointment"]');
    
    // Verify success
    await expect(page.locator('[data-testid="success-message"]')).toBeVisible();
    await expect(page.locator('[data-testid="appointment-confirmation"]')).toContainText('APT-');
  });
  ```

## Healthcare Test Data Management & PHI Protection

- **Synthetic Test Data**: Use realistic but fake healthcare data for testing
- **PHI Protection**: Never use real patient data in tests
- **Test Data Factories**:
  ```typescript
  // Healthcare test data factories
  export const createTestPatient = (overrides = {}) => ({
    id: `PAT-${Math.random().toString(36).substr(2, 9)}`,
    firstName: 'Test',
    lastName: 'Patient',
    dateOfBirth: '1980-01-01',
    phoneNumber: '555-0123',
    email: 'test.patient@example.com',
    medicalRecordNumber: `MRN-${Math.random().toString(36).substr(2, 6)}`,
    ...overrides
  });
  
  export const createTestAppointment = (overrides = {}) => ({
    id: `APT-${Math.random().toString(36).substr(2, 9)}`,
    patientId: 'PAT-TEST123',
    providerId: 'DOC-TEST456',
    appointmentDate: '2024-01-15T10:00:00Z',
    status: 'scheduled',
    type: 'routine_checkup',
    duration: 30,
    ...overrides
  });
  ```

## Healthcare Quality Assurance & Compliance Testing

- **HIPAA Compliance Testing**: Verify all PHI protection measures
- **Accessibility Testing**: Ensure WCAG 2.1 AA compliance for healthcare interfaces
- **Performance Testing**: Test healthcare application performance under load
- **Security Testing**: Regular security vulnerability assessments
- **Compliance Checklist**:
  ```typescript
  describe('HIPAA Compliance Tests', () => {
    test('ensures no PHI in client-side storage', () => {
      // Test that localStorage/sessionStorage contains no PHI
      const localStorage = window.localStorage;
      const sessionStorage = window.sessionStorage;
      
      // Check for common PHI patterns
      const phiPatterns = [/\d{3}-\d{2}-\d{4}/, /patient.*name/i, /medical.*record/i];
      
      Object.keys(localStorage).forEach(key => {
        const value = localStorage.getItem(key);
        phiPatterns.forEach(pattern => {
          expect(value).not.toMatch(pattern);
        });
      });
    });
    
    test('ensures proper audit logging', async () => {
      // Test that sensitive actions are properly logged
      const auditSpy = jest.spyOn(auditLogger, 'log');
      
      await accessPatientRecord('PAT-123');
      
      expect(auditSpy).toHaveBeenCalledWith({
        action: 'patient_record_access',
        userId: 'USER-456',
        timestamp: expect.any(Date),
        resource: 'patient_record',
        resourceId: 'PAT-123'
      });
    });
  });
  ```

## Healthcare Continuous Integration & Testing Pipeline

- **Pre-commit Testing**: Run healthcare-critical tests before code commits
- **CI/CD Pipeline**: Comprehensive healthcare testing in continuous integration
- **Test Coverage**: Maintain high test coverage for healthcare-critical code paths
- **Security Scanning**: Automated security vulnerability scanning
- **Performance Monitoring**: Continuous performance testing for healthcare workflows
- **Compliance Validation**: Automated HIPAA compliance checks in CI/CD pipeline
  description:
  globs:
  alwaysApply: false

---
